# 餐饮门店选址辅助工具 (MVP) 需求文档

## 一、项目概述与目标

### 1.1 项目名称
餐饮门店选址辅助工具（代号：Location Scout MVP）

### 1.2 目标用户
* 个体餐饮创业者
* 连锁餐饮品牌的选址/拓展部门

### 1.3 核心痛点
* 传统选址依赖经验，数据支持不足，风险高。
* 收集和分析地理、竞争数据耗时耗力。

### 1.4 核心价值
提供**数据驱动**、**可视化**、**高效率**的选址辅助决策。

### 1.5 产品阶段
最小可行产品 (MVP) 阶段，功能聚焦于 **POI 数据驱动的竞争与区位分析**。

### 1.6 成功度量（验收指标）
* 首次使用用户完成一次完整的选址分析流程（从选择城市到查看数据面板）平均耗时 ≤ 5 分钟。
* 核心交互（地图拖拽、图层开关、选址圈绘制）错误率 < 2%（以埋点统计异常请求、API 报错计）。
* 右侧数据面板核心指标加载时间 ≤ 3 秒（以 1000m 半径、POI 数量 < 1000 为基准）。
* 首批试点用户（≥ 5 名）对功能易用性平均评分 ≥ 4/5。

### 1.7 术语定义
* **主品牌**：用户当前关注或经营的餐饮品牌，需重点查看自身门店分布。
* **竞品品牌**：与主品牌定位或客群接近的其他品牌集合，由用户自定义。
* **分析圈 / 商圈半径**：以 POI 或指定点位为圆心的分析范围，用于统计周边指标。
* **品牌密度**：给定范围内单位区域的相关门店数量，经网格化后映射为热力图数值。
* **POI 数据**：来源于地图服务提供商的兴趣点数据，至少包含名称、地址、经纬度、类别。

---

## 二、核心功能与数据规划

本 MVP 阶段所有功能均基于 **POI (Point of Interest) 数据**，以实现快速验证和最小化数据采集成本。

| 模块 | 功能名称 | 描述 | 数据/技术方案 | 交互/半径设计 |
| :--- | :--- | :--- | :--- | :--- |
| **基础功能** | 地图与城市选择 | 支持地图展示、目标城市选择。 | 高德/百度/腾讯地图 API | 默认地图视图 |
| **1. 市场分析** | **品牌密度热力图** | 基于用户输入的餐饮品牌关键词列表，搜索全市 POI 密度，绘制热力图，识别餐饮聚集区。 | **简化数据源：** 地图 API POI 搜索（关键词列表）。 | **图层说明：** 命名为“品牌集中度图”，避免与“人流热力图”混淆。 |
| **2. 竞争分析** | **主品牌现存门店标识** | 搜索并标识主品牌的所有门店 POI。 | 地图 API POI 搜索（主品牌关键词）。 | 以 POI 为圆心，绘制 **500m 半径**圆（核心商圈）。 |
| **3. 竞争分析** | **竞品品牌门店标识** | 搜索并标识用户关注的竞品品牌门店 POI。 | 地图 API POI 搜索（竞品关键词列表）。 | 默认以 POI 为圆心，绘制 **100m 半径**圆（直接竞争）。**可定制**半径。 |
| **4. 点位聚焦** | **选址规划图层** | 支持输入地址/POI 搜索，或手动点击地图，在目标点位绘制分析圈。 | 地图 API 搜索/点击定位。 | **默认半径：1000m**，作为商圈分析半径。允许用户切换 500m/800m 等半径。 |
| **5. 报表输出** | **目标点位数据面板** | 当用户绘制“选址规划图层”后，右侧数据面板实时展示量化分析结果。 | 实时计算 POI 数量。 | 数据面板实时更新。 |

---

### 2.1 功能需求详述

#### 地图与城市选择
* **输入**：城市列表（建议覆盖 20-30 个重点城市，可按配置扩展），默认定位为上一次使用的城市或用户允许的浏览器定位。
* **行为**：切换城市后重置地图视角到城市中心，并清空当前绘制的选址圈与统计数据。
* **输出**：地图视角更新，同时触发图层数据重新请求。
* **异常处理**：当 API 返回为空或超限时，提示“当前城市暂无数据，请稍后重试”。

#### 品牌密度热力图
* **输入**：最多 10 个关键词（品牌名称或品类），支持中英文与模糊匹配。
* **计算**：调用 POI 搜索接口，按固定网格（建议 500m×500m）聚合计数，并归一化为 0-1 区间。
* **输出**：地图热力图层，配色由低（蓝）到高（红），需提供图例说明。
* **性能**：首次加载需在 3 秒内完成渲染；重复搜索相同关键词组合从缓存读取结果。
* **异常**：当调用接口达到限额时，继续展示上一版本数据并显示提醒。

#### 主品牌现存门店标识
* **输入**：主品牌关键词，支持多关键词组合（如直营/加盟）。
* **行为**：展示所有匹配 POI 的定位点与 500m 圈层；切换至列表模式可查看门店名称、地址、电话（如 API 提供）。
* **数据处理**：去重逻辑以“坐标 + 名称 80% 相似度”为准，避免重复点。
* **交互**：点击列表项高亮地图位置，支持导出 CSV（门店名、地址、经纬度）。

#### 竞品品牌门店标识
* **输入**：竞品关键词列表，默认半径 100m，用户可选择 100m/300m/500m。
* **行为**：在地图上以不同颜色标识竞品 POI，允许与主品牌图层同时展示。
* **数据处理**：竞品门店数量较多时，按缩放级别聚合展示（Cluster）。
* **异常**：若关键词过泛导致返回结果 > 5000 条，提醒用户细化搜索条件。

#### 选址规划图层
* **输入**：地址搜索 / 地图点击；允许用户拖动圆心并调整半径（100m-1500m）。
* **行为**：绘制完成后自动刷新数据面板；支持保存多个候选点并在图层面板切换显示。
* **约束**：最多同时保留 3 个候选点，以保持界面清晰。

#### 目标点位数据面板
* **显示结构**：品牌竞争概览 + 商业配套指数（后续迭代）；指标以模块卡片形式展示。
* **指标计算**：
  * 主品牌门店数量：统计选址圆内（默认 1000m）主品牌 POI 去重后的数量，同时展示 500m 数据。
  * 竞品门店数量：分别统计 100m、300m、1000m 圆环内的 POI 数，支持下拉切换。
  * 品牌密度等级：采用热力图的网格值映射，高/中/低阈值由产品统一配置。
* **交互**：支持展开查看门店列表，提供“重新计算”按钮用于手动刷新数据。

### 2.2 典型用户流程

1. 用户登录后默认进入上次使用城市或系统默认城市。
2. 在顶部输入主品牌和竞品关键词，打开对应地图图层。
3. 浏览品牌密度热力图，缩放定位到关注区域。
4. 点击“选址规划”并在候选位置绘制分析圈，根据需要调整半径。
5. 右侧数据面板展示结果，用户可在候选点列表中对比不同点位的指标。
6. 如需输出，用户可导出当前候选点数据或保存截图用于汇报。

### 2.3 数据与技术约束

* **调用频率**：建议通过后端 Proxy 管理地图 API 调用，并记录配额使用情况。
* **缓存策略**：城市 + 关键词组合的热力图与门店列表缓存 24 小时；选址圈分析结果缓存 2 小时。
* **数据更新**：每日凌晨刷新基础 POI 缓存，确保数据不晚于官方 API 更新时间 48 小时。
* **精度要求**：经纬度保留六位小数；半径计算使用球面距离，误差控制在 5m 内。
* **多源数据对齐**：若后续引入其他数据源，需在后端统一对齐字段（名称、类别、更新时间）。

### 2.4 本地数据库与数据复用

* **存储目标**：将高德 API 返回的原始 POI 数据与聚合结果同步写入本地数据库，减少重复调取成本。
* **建议实现**：使用 SQLite / PostgreSQL 等轻量数据库，设计 `poi_cache`、`poi_aggregate` 两张核心表：
  * `poi_cache` 字段示例：`id`（POI 唯一标识）、`keyword`、`poi_id`、`name`、`category`、`address`、`location`（经纬度）、`fetch_source`、`fetched_at`。
  * `poi_aggregate` 字段示例：`city`、`keyword_set_hash`、`grid_id`、`poi_count`、`radius`、`computed_at`。
* **读写流程**：
  1. 用户发起搜索 → 后端先检查本地数据库是否存在满足关键词与城市条件的缓存、并在 TTL 内（默认 24 小时）。
  2. 如命中缓存 → 直接返回缓存结果并记录访问次数。
  3. 如未命中 → 调用高德 API，写入本地数据库后再返回客户端。
* **数据过期策略**：按 `fetched_at` 字段定期清理 48 小时以上的记录；支持手动触发重算。
* **可视化复用**：地图图层与数据面板读取同一缓存层，避免重复请求，提高响应速度。

---

## 三、产品设计与用户体验 (UX)

### 3.1 核心界面布局
* **中央大地图：** 核心展示区，支持图层叠加（功能 1, 2, 3, 4）。
* **左侧/顶部操作区：** 城市选择、主/竞品关键词输入、目标点位搜索框。
* **右侧数据面板：** 展示功能 5 的量化分析结果。

### 3.2 关键交互设计

| 交互点 | 描述 |
| :--- | :--- |
| **图层管理** | 提供清晰的图层开关（Layer Toggle），允许用户独立控制“品牌密度图”、“主品牌圈”和“竞品品牌圈”的显示与隐藏。 |
| **画圈分析** | **“选址规划图层”** 的绘制工具，应在工具栏醒目显示，方便用户点击并标记目标点。 |
| **实时反馈** | 当用户拖动地图、缩放或改变半径时，右侧数据面板的内容应**实时更新**。 |
| **信息浮窗** | 鼠标悬停（或点击）主/竞品门店 POI 时，应显示该门店的基本信息（品牌名、地址）。 |

### 3.3 目标点位数据面板（右侧）结构（MVP）

当用户标记一个 1000m **目标商圈**后，面板应即时显示：

#### A. 品牌竞争概览
* 主品牌门店数量（500m 半径内）：$X$ 家
* 竞品门店数量（100m 半径内）：$Y$ 家
* 竞品门店总数量（1000m 半径内）：$Z$ 家
* 区域品牌密度等级：高/中/低（基于热力图颜色）

#### B. 商业配套指数（*此部分 POI 数据需在后续迭代中引入并计算*）
* 周边写字楼数量（1000m 内）
* 周边住宅小区数量（1000m 内）
* 交通站点（地铁/公交）数量（1000m 内）

### 3.4 空态与异常反馈
* 当关键词搜索结果为空时，展示占位信息并提供“尝试更换关键词/半径”的提示。
* API 返回错误时，在页面顶部显示错误条幅，并支持用户重试调用。
* 图层叠加数量过多导致渲染性能下降时，提示用户暂时关闭部分图层。

### 3.5 响应式与性能考虑
* 桌面端优先适配 1440px、1280px 分辨率，最小支持 1024px。
* 平板端提供简化布局：图层控制折叠为抽屉，数据面板调整为底部浮层。
* 地图目标帧率 30fps，图层切换时控制单次渲染的点位 < 1000 个。

---

## 四、技术与数据合规建议

### 4.1 技术选型
* **前端框架：** React / Vue / Angular (推荐 React/Vue 便于快速开发)
* **地图 API：** 已选定高德地图（Gaode / AMap），使用 Place Search、Place Around 等服务，需结合企业账号配额与计费策略。

### 4.2 数据获取与合规性
* 严格遵守所选地图服务商的 **API 使用条款**和**调用频率限制**。
* 所有 POI 数据获取必须通过**合法授权的 API 接口**，严禁使用未经授权的**爬虫**或**大规模数据下载**。
* 数据的时效性、准确性与清洗是项目成功的关键。

### 4.3 架构与集成建议
* 前端通过轻量 BFF（Backend For Frontend）层访问地图服务，实现统一签名、限流和错误处理。
* 地图 API Key 存放于服务器端，前端仅调用内部接口，避免泄露。
* 建议引入前端埋点与后端日志，记录 PV、图层开关次数、API 报错等关键指标，为产品决策提供依据。

### 4.4 质量保障
* 关键数据处理函数（半径计算、POI 去重聚合）单元测试覆盖率 ≥ 80%。
* 对核心界面引入可视化回归（截图 / DOM 快照）测试，防止图层样式误差。
* 上线前准备至少 10 组真实测试关键词，核对地图展示与数据面板指标一致性。

### 4.5 配置管理
* 新增 `config/gaode.config.json`，用于存放高德地图 API 配置；`apiKey` 字段由运维/开发手动填充，严禁提交真实密钥至版本库。
* 服务端在启动时读取配置并注入到 BFF 层，所有外部请求统一通过后端代理，避免在前端暴露密钥。
* 推荐同时在部署环境配置备选环境变量（如 `GAODE_API_KEY`），当未检测到本地配置文件或密钥失效时可回退至环境变量。

---

## 五、范围界定与风险

### 5.1 本期范围
* 仅支持 Web 桌面端；移动端、小程序暂不纳入本期。
* 仅覆盖 POI 数据驱动的热力图、门店分布与基础统计，不包含收费策略、账号体系。
* 不提供自动推荐选址功能，MVP 以可视化与基础数据对比为主。

### 5.2 风险与应对
* **数据配额风险**：地图 API 调用成本或限额不足 → 提前评估预算，设置调用熔断及降级提示。
* **关键词准确性风险**：输入过泛或存在错别字 → 提供热门关键词建议与输入校验。
* **数据时效性风险**：POI 更新滞后导致结果偏差 → 显示最近更新时间，并提供纠错/反馈入口。
* **性能风险**：高密度区域渲染压力大 → 实施分级聚合与图层懒加载。

---
v1.1 选址规划功能优化
目标：支持在地图上标记感兴趣的点位，作为未来选址规划点。
功能：规划点位增、删、改、查
详细设计：
- 一个规划点位由圆心（即一个坐标）、半径、名称、颜色等数据字段
- 新增：支持2种方式新增，
    - 1. 是点击新增按钮，输入关键字，调用地图接口搜索到对应的POI坐标，作为圆心。半径默认1000m，可手动修改；名称默认POI名称；颜色默认为绿色描边、40%透明绿色填充。
    - 2. 是点击新增按钮后，在地图上点选一个点作为圆心。其他字段同上。
    - 规划点位保存在数据库中。
- 删除：选址规划圈下显示所有规划点位，支持删除
- 改：支持修改各项参数。
