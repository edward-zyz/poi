# Railway å¿«é€Ÿéƒ¨ç½²æŒ‡å— ğŸš€

## ğŸ¯ éœ€è¦çš„æ“ä½œæ¸…å•

### âœ… 1. æ¨é€ä»£ç åˆ°GitHub
```bash
git push origin master
```

### âœ… 2. Railway é¡¹ç›®è®¾ç½®
1. **ç™»å½• Railway æ§åˆ¶å°**ï¼šhttps://railway.app
2. **åˆ›å»ºæ–°é¡¹ç›®**æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. **è¿æ¥GitHubä»“åº“**ï¼šé€‰æ‹©ä½ çš„POIé¡¹ç›®ä»“åº“
4. **è®¾ç½®æ„å»ºæ ¹ç›®å½•**ï¼š`backend`

### âœ… 3. é…ç½®ç¯å¢ƒå˜é‡
åœ¨é¡¹ç›®çš„ **Variables** æ ‡ç­¾é¡µæ·»åŠ ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `NODE_ENV` | `production` | ç”Ÿäº§ç¯å¢ƒ |
| `GAODE_API_KEY` | `ä½ çš„é«˜å¾·APIå¯†é’¥` | **å¿…éœ€** |
| `CACHE_TTL_HOURS` | `168` | 7å¤©ç¼“å­˜ |
| `GAODE_TIMEOUT_MS` | `600000` | 10åˆ†é’Ÿè¶…æ—¶ |

### âœ… 4. å¯ç”¨Volumeå­˜å‚¨ï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰
1. åœ¨é¡¹ç›®è®¾ç½®ä¸­æ‰¾åˆ° **Storage** æˆ– **Volumes** é€‰é¡¹
2. **æ·»åŠ Volume**ï¼š
   - **Name**: `poi-storage`
   - **Mount Path**: `/app/storage`
   - **Size**: é€‰æ‹©åˆé€‚å¤§å°ï¼ˆå»ºè®®1GBä»¥ä¸Šï¼‰

> âš ï¸ **é‡è¦**ï¼šå¦‚æœæ‰¾ä¸åˆ°Volumeé€‰é¡¹ï¼Œ`railway.toml` é…ç½®æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œä½†å»ºè®®æ‰‹åŠ¨ç¡®è®¤ã€‚

### âœ… 5. éƒ¨ç½²å’ŒéªŒè¯
1. **è§¦å‘éƒ¨ç½²**ï¼šæ¨é€ä»£ç åRailwayä¼šè‡ªåŠ¨å¼€å§‹éƒ¨ç½²
2. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**ï¼šé€šå¸¸éœ€è¦2-5åˆ†é’Ÿ
3. **è·å–é¡¹ç›®URL**ï¼šéƒ¨ç½²å®Œæˆååœ¨Railwayæ§åˆ¶å°æŸ¥çœ‹
4. **éªŒè¯æœåŠ¡**ï¼š
   ```bash
   # æ›¿æ¢ä¸ºä½ çš„é¡¹ç›®URL
   curl https://your-project.up.railway.app/api/status
   ```

### âœ… 6. æµ‹è¯•æ•°æ®æŒä¹…åŒ–
1. **é¦–æ¬¡æ•°æ®å¡«å……**ï¼š
   ```bash
   curl -X POST https://your-project.up.railway.app/api/poi/cache/refresh \
     -H "Content-Type: application/json" \
     -d '{
       "city": "ä¸Šæµ·å¸‚", 
       "keywords": ["è‚¯å¾·åŸº", "éº¦å½“åŠ³"]
     }'
   ```

2. **éªŒè¯çƒ­åŠ›å›¾**ï¼š
   ```bash
   curl -X POST https://your-project.up.railway.app/api/poi/density \
     -H "Content-Type: application/json" \
     -d '{
       "city": "ä¸Šæµ·å¸‚",
       "keywords": ["è‚¯å¾·åŸº", "éº¦å½“åŠ³"],
       "mainBrand": "è‚¯å¾·åŸº"
     }'
   ```

3. **æµ‹è¯•æŒä¹…åŒ–**ï¼š
   - åœ¨Railwayæ§åˆ¶å°æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
   - å†æ¬¡è°ƒç”¨APIéªŒè¯æ•°æ®æ˜¯å¦ä¿æŒ

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¦‚æœéƒ¨ç½²å¤±è´¥
1. æ£€æŸ¥ **Logs** æ ‡ç­¾é¡µçš„é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤ç¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®
3. éªŒè¯ `railway.toml` æ–‡ä»¶åœ¨ `backend` ç›®å½•ä¸­

### å¦‚æœVolumeä¸å·¥ä½œ
1. æ£€æŸ¥ `/api/status` å“åº”ä¸­çš„ `storageType` æ˜¯å¦ä¸º `"persistent-volume"`
2. æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰ `Storage health check failed` é”™è¯¯
3. ç¡®è®¤VolumeæŒ‚è½½è·¯å¾„ä¸º `/app/storage`

### å¦‚æœæ•°æ®ä»ç„¶ä¸¢å¤±
1. ç¡®è®¤Volumeé…ç½®æ­£ç¡®
2. æ£€æŸ¥Railwayå­˜å‚¨é…é¢
3. æŸ¥çœ‹æ•°æ®åº“è·¯å¾„æ˜¯å¦ä¸º `/app/storage/poi-cache.sqlite`

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ Railway é¡¹ç›®æ—¥å¿—
2. ç¡®è®¤æ‰€æœ‰ç¯å¢ƒå˜é‡å·²è®¾ç½®
3. éªŒè¯Volumeé…ç½®
4. æ£€æŸ¥ `backend/docs/RAILWAY_DEPLOYMENT.md` è¯¦ç»†æ–‡æ¡£

---

## ğŸ‰ é¢„æœŸç»“æœ

æˆåŠŸéƒ¨ç½²åï¼Œä½ å°†çœ‹åˆ°ï¼š
- âœ… æœåŠ¡çŠ¶æ€æ­£å¸¸
- âœ… å­˜å‚¨ç±»å‹ä¸º `persistent-volume`
- âœ… æ•°æ®åº“è·¯å¾„ä¸º `/app/storage/poi-cache.sqlite`
- âœ… POIæ•°æ®åœ¨é‡æ–°éƒ¨ç½²åä¿æŒ
- âœ… çƒ­åŠ›å›¾åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿå…ˆæ¨é€ä»£ç ï¼Œç„¶ååœ¨Railwayä¸­æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ“ä½œï¼** ğŸš€